box: php
no-response-timeout: 10
build-box:
  steps:
    - install-packages:
        packages: git zip bzip2 libxml2-dev libcurl4-openssl-dev pkg-config libssl-dev
    - script:
        name: install phpbrew
        code: |-
            curl -L -O https://github.com/phpbrew/phpbrew/raw/master/phpbrew
            chmod +x phpbrew
            sudo mv phpbrew /usr/local/bin/phpbrew
            phpbrew init
            echo "[[ -e ~/.phpbrew/bashrc ]] && source ~/.phpbrew/bashrc" >> ~/.bashrc
    - script:
        name: install PHP 5.5.37
        code: phpbrew -q install 5.5.37 +curl +dom +hash +iconv +json +mbstring +mbregex +mcrypt +mhash +opcache +openssl +pcre +phar +intl +filter +ctype +zip +openssl=/usr/include/openssl
    - script:
        name: install PHP 5.6.24
        code: phpbrew -q install 5.6.24 +curl +dom +hash +iconv +json +mbstring +mbregex +mcrypt +mhash +opcache +openssl +pcre +phar +intl +filter +ctype +zip +openssl=/usr/include/openssl
    - script:
        name: install PHP 7.0.9
        code: phpbrew -q install 7.0.9 +curl +dom +hash +iconv +json +mbstring +mbregex +mcrypt +mhash +opcache +openssl +pcre +phar +intl +filter +ctype +zip +openssl=/usr/include/openssl
    - script:
        name: install composer
        code: curl -sS https://getcomposer.org/installer | sudo php -- --install-dir=/usr/local/bin --filename=composer
build-dev:
  steps:
    - script:
        name: install dependencies
        code: composer install --no-interaction
run-tests:
    - script:
        name: PHPUnit Tests on PHP 5.5
        code: phpbrew use 5.5.37 && vendor/bin/phpunit
    - script:
        name: PHPUnit Tests on PHP 5.6
        code: phpbrew use 5.6.24 && vendor/bin/phpunit
    - script:
        name: PHPUnit Tests on PHP 7.0
        code: phpbrew use 7.0.9 && vendor/bin/phpunit
